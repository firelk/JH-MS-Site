!function(){function e(e){var t=e.naturalWidth;if(t*e.naturalHeight>1048576){var a=document.createElement("canvas");a.width=a.height=1;var r=a.getContext("2d");return r.drawImage(e,1-t,0),0===r.getImageData(0,0,1,1).data[3]}return!1}function t(e,t,a){var r=document.createElement("canvas");r.width=1,r.height=a;var i=r.getContext("2d");i.drawImage(e,0,0);for(var n=i.getImageData(0,0,1,a).data,o=0,s=a,c=a;c>o;)0===n[4*(c-1)+3]?s=c:o=c,c=s+o>>1;var h=c/a;return 0===h?1:h}function a(e,t,a){var i=document.createElement("canvas");return r(e,i,t,a),i.toDataURL("image/jpeg",t.quality||.8)}function r(a,r,n,o){var s=a.naturalWidth,c=a.naturalHeight;if(s+c){var h=n.width,d=n.height,l=r.getContext("2d");l.save(),i(r,l,h,d,n.orientation),e(a)&&(s/=2,c/=2);var g=1024,u=document.createElement("canvas");u.width=u.height=g;for(var f=u.getContext("2d"),m=o?t(a,s,c):1,w=Math.ceil(g*h/s),b=Math.ceil(g*d/c/m),v=0,L=0;v<c;){for(var I=0,R=0;I<s;)f.clearRect(0,0,g,g),f.drawImage(a,-I,-v),l.drawImage(u,0,0,g,g,R,L,w,b),I+=g,R+=w;v+=g,L+=b}l.restore(),u=f=null}}function i(e,t,a,r,i){switch(i){case 5:case 6:case 7:case 8:e.width=r,e.height=a;break;default:e.width=a,e.height=r}switch(i){case 2:t.translate(a,0),t.scale(-1,1);break;case 3:t.translate(a,r),t.rotate(Math.PI);break;case 4:t.translate(0,r),t.scale(1,-1);break;case 5:t.rotate(.5*Math.PI),t.scale(1,-1);break;case 6:t.rotate(.5*Math.PI),t.translate(0,-r);break;case 7:t.rotate(.5*Math.PI),t.translate(a,-r),t.scale(-1,1);break;case 8:t.rotate(-.5*Math.PI),t.translate(-a,0)}}function n(e){if(window.Blob&&e instanceof Blob){if(!o)throw Error("No createObjectURL function found to create blob url");var t=new Image;t.src=o.createObjectURL(e),this.blob=e,e=t}if(!e.naturalWidth&&!e.naturalHeight){var a=this;e.onload=e.onerror=function(){var e=a.imageLoadListeners;if(e){a.imageLoadListeners=null;for(var t=0,r=e.length;t<r;t++)e[t]()}},this.imageLoadListeners=[]}this.srcImage=e}var o=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;n.prototype.render=function(e,t,i){if(this.imageLoadListeners){var n=this;this.imageLoadListeners.push(function(){n.render(e,t,i)})}else{t=t||{};var s=this.srcImage.naturalWidth,c=this.srcImage.naturalHeight,h=t.width,d=t.height,l=t.maxWidth,g=t.maxHeight,u=!this.blob||"image/jpeg"===this.blob.type;h&&!d?d=c*h/s<<0:d&&!h?h=s*d/c<<0:(h=s,d=c),l&&h>l&&(d=c*(h=l)/s<<0),g&&d>g&&(h=s*(d=g)/c<<0);var f={width:h,height:d};for(var m in t)f[m]=t[m];var w=e.tagName.toLowerCase();"img"===w?e.src=a(this.srcImage,f,u):"canvas"===w&&r(this.srcImage,e,f,u),"function"==typeof this.onrender&&this.onrender(e),i&&i(),this.blob&&(this.blob=null,o.revokeObjectURL(this.srcImage.src))}},"function"==typeof define&&define.amd?define([],function(){return n}):"object"==typeof exports?module.exports=n:this.MegaPixImage=n}();