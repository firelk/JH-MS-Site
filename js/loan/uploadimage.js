function selectFileImage(t){var a=t.files[0],e=null,i=$(t).attr("id"),r=$(t).prev().attr("id");if($(t).val()&&($(t).prev().attr("src","/bulid/img/lodding.gif"),a)){if(console.log("正在上传,请稍后..."),!/^(image\/jpeg|image\/png)$/i.test(a.type))return;if(EXIF.getData(a,function(){EXIF.getAllTags(this),e=EXIF.getTag(this,"Orientation")}),window.FileReader){var h=new FileReader;h.onload=function(t){var a=new Image;a.src=t.target.result,a.onload=function(){var t=this.naturalWidth,a=this.naturalHeight;this.naturalWidth>this.naturalHeight&&this.naturalWidth>1e3?a=(t=1e3)*this.naturalHeight/this.naturalWidth:this.naturalHeight>this.naturalWidth&&this.naturalHeight>1e3&&(t=(a=1e3)*this.naturalWidth/this.naturalHeight);var h=document.createElement("canvas"),g=h.getContext("2d");h.width=t,h.height=a,g.drawImage(this,0,0,t,a);if(navigator.userAgent.match(/iphone/i)){if(""!=e&&1!=e)switch(e){case 6:rotateImg(this,"left",h);break;case 8:rotateImg(this,"right",h);break;case 3:rotateImg(this,"",h)}postImgIphone(h.toDataURL("image/jpeg",.9),r,i)}else if(navigator.userAgent.match(/Android/i))postImgAndroid((new JPEGEncoder).encode(g.getImageData(0,0,t,a),90),r,i);else{if(""!=e&&1!=e)switch(e){case 6:rotateImg(this,"left",h);break;case 8:rotateImg(this,"right",h);break;case 3:rotateImg(this,"",h)}postImgAndroid(h.toDataURL("image/jpeg",.9),r,i)}}},h.readAsDataURL(a)}}}function postImgAndroid(t,a,e){var i=$("#"+a);$("#"+e+"-src");if(i.attr("src",t),!t)return!1}function postImgIphone(t,a,e){var i=$("#"+a);$("#"+e+"-src");i.attr("src",t)}function rotateImg(t,a,e){if(null!=t){var i=t.height,r=t.width,h=2;null==h&&(h=0),"right"==a?++h>3&&(h=0):"left"==a&&--h<0&&(h=3);var g=90*h*Math.PI/180,n=e.getContext("2d");switch(h){case 0:e.width=r,e.height=i,n.drawImage(t,0,0);break;case 1:e.width=i,e.height=r,n.rotate(g),n.drawImage(t,0,-i);break;case 2:e.width=r,e.height=i,n.rotate(g),n.drawImage(t,-r,-i);break;case 3:e.width=i,e.height=r,n.rotate(g),n.drawImage(t,-r,0)}}}