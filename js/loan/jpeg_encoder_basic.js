function JPEGEncoder(r){function a(r){for(var a=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],n=0;n<64;n++){var o=M((a[n]*r+50)/100);o<1?o=1:o>255&&(o=255),p[x[n]]=o}for(var e=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],f=0;f<64;f++){var t=M((e[f]*r+50)/100);t<1?t=1:t>255&&(t=255),C[x[f]]=t}for(var i=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],v=0,c=0;c<8;c++)for(var u=0;u<8;u++)b[v]=1/(p[x[v]]*i[c]*i[u]*8),j[v]=1/(C[x[v]]*i[c]*i[u]*8),v++}function n(r,a){for(var n=0,o=0,e=new Array,f=1;f<=16;f++){for(var t=1;t<=r[f];t++)e[a[o]]=[],e[a[o]][0]=n,e[a[o]][1]=f,o++,n++;n*=2}return e}function o(){m=n(B,F),s=n(L,O),D=n(H,K),T=n(R,V)}function e(){for(var r=1,a=2,n=1;n<=15;n++){for(var o=r;o<a;o++)z[32767+o]=n,_[32767+o]=[],_[32767+o][1]=n,_[32767+o][0]=o;for(var e=-(a-1);e<=-r;e++)z[32767+e]=n,_[32767+e]=[],_[32767+e][1]=n,_[32767+e][0]=a-1+e;r<<=1,a<<=1}}function f(){for(var r=0;r<256;r++)q[r]=19595*r,q[r+256>>0]=38470*r,q[r+512>>0]=7471*r+32768,q[r+768>>0]=-11059*r,q[r+1024>>0]=-21709*r,q[r+1280>>0]=32768*r+8421375,q[r+1536>>0]=-27439*r,q[r+1792>>0]=-5329*r}function t(r){for(var a=r[0],n=r[1]-1;n>=0;)a&1<<n&&(N|=1<<P),n--,--P<0&&(255==N?(i(255),i(0)):i(N),P=7,N=0)}function i(r){J.push(k[r])}function v(r){i(r>>8&255),i(255&r)}function c(r,a){var n,o,e,f,t,i,v,c,u,w=0;for(u=0;u<8;++u){n=r[w],o=r[w+1],e=r[w+2],f=r[w+3],t=r[w+4],i=r[w+5],v=r[w+6];var y=n+(c=r[w+7]),g=n-c,A=o+v,h=o-v,l=e+i,d=e-i,m=f+t,s=f-t,D=y+m,T=y-m,E=A+l,M=A-l;r[w]=D+E,r[w+4]=D-E;var p=.707106781*(M+T);r[w+2]=T+p,r[w+6]=T-p;var C=.382683433*((D=s+d)-(M=h+g)),b=.5411961*D+C,j=1.306562965*M+C,_=.707106781*(E=d+h),z=g+_,I=g-_;r[w+5]=I+b,r[w+3]=I-b,r[w+1]=z+j,r[w+7]=z-j,w+=8}for(w=0,u=0;u<8;++u){n=r[w],o=r[w+8],e=r[w+16],f=r[w+24],t=r[w+32],i=r[w+40],v=r[w+48];var J=n+(c=r[w+56]),N=n-c,P=o+v,Q=o-v,S=e+i,U=e-i,k=f+t,q=f-t,x=J+k,B=J-k,F=P+S,H=P-S;r[w]=x+F,r[w+32]=x-F;var K=.707106781*(H+B);r[w+16]=B+K,r[w+48]=B-K;var L=.382683433*((x=q+U)-(H=Q+N)),O=.5411961*x+L,R=1.306562965*H+L,V=.707106781*(F=U+Q),W=N+V,X=N-V;r[w+40]=X+O,r[w+24]=X-O,r[w+8]=W+R,r[w+56]=W-R,w++}var Y;for(u=0;u<64;++u)Y=r[u]*a[u],G[u]=Y>0?Y+.5|0:Y-.5|0;return G}function u(){v(65504),v(16),i(74),i(70),i(73),i(70),i(0),i(1),i(1),i(0),v(1),v(1),i(0),i(0)}function w(r,a){v(65472),v(17),i(8),v(a),v(r),i(3),i(1),i(17),i(0),i(2),i(17),i(1),i(3),i(17),i(1)}function y(){v(65499),v(132),i(0);for(var r=0;r<64;r++)i(p[r]);i(1);for(var a=0;a<64;a++)i(C[a])}function g(){v(65476),v(418),i(0);for(var r=0;r<16;r++)i(B[r+1]);for(var a=0;a<=11;a++)i(F[a]);i(16);for(var n=0;n<16;n++)i(H[n+1]);for(var o=0;o<=161;o++)i(K[o]);i(1);for(var e=0;e<16;e++)i(L[e+1]);for(var f=0;f<=11;f++)i(O[f]);i(17);for(var t=0;t<16;t++)i(R[t+1]);for(var c=0;c<=161;c++)i(V[c])}function A(){v(65498),v(12),i(3),i(1),i(0),i(2),i(17),i(3),i(17),i(0),i(63),i(0)}function h(r,a,n,o,e){for(var f,i=e[0],v=e[240],u=c(r,a),w=0;w<64;++w)I[x[w]]=u[w];var y=I[0]-n;n=I[0],0==y?t(o[0]):(t(o[z[f=32767+y]]),t(_[f]));for(var g=63;g>0&&0==I[g];g--);if(0==g)return t(i),n;for(var A,h=1;h<=g;){for(var l=h;0==I[h]&&h<=g;++h);var d=h-l;if(d>=16){A=d>>4;for(var m=1;m<=A;++m)t(v);d&=15}f=32767+I[h],t(e[(d<<4)+z[f]]),t(_[f]),h++}return 63!=g&&t(i),n}function l(){for(var r=String.fromCharCode,a=0;a<256;a++)k[a]=r(a)}function d(r){if(r<=0&&(r=1),r>100&&(r=100),E!=r){a(r<50?Math.floor(5e3/r):Math.floor(200-2*r)),E=r,console.log("Quality set to: "+r+"%")}}Math.round;var m,s,D,T,E,M=Math.floor,p=new Array(64),C=new Array(64),b=new Array(64),j=new Array(64),_=new Array(65535),z=new Array(65535),G=new Array(64),I=new Array(64),J=[],N=0,P=7,Q=new Array(64),S=new Array(64),U=new Array(64),k=new Array(256),q=new Array(2048),x=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],B=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],F=[0,1,2,3,4,5,6,7,8,9,10,11],H=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],K=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],L=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],O=[0,1,2,3,4,5,6,7,8,9,10,11],R=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],V=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];this.encode=function(r,a,n){var o=(new Date).getTime();a&&d(a),J=new Array,N=0,P=7,v(65496),u(),y(),w(r.width,r.height),g(),A();var e=0,f=0,i=0;N=0,P=7,this.encode.displayName="_encode_";for(var c,l,E,M,p,C,_,z,G,I=r.data,k=r.width,x=r.height,B=4*k,F=0;F<x;){for(c=0;c<B;){for(C=p=B*F+c,_=-1,z=0,G=0;G<64;G++)C=p+(z=G>>3)*B+(_=4*(7&G)),F+z>=x&&(C-=B*(F+1+z-x)),c+_>=B&&(C-=c+_-B+4),l=I[C++],E=I[C++],M=I[C++],Q[G]=(q[l]+q[E+256>>0]+q[M+512>>0]>>16)-128,S[G]=(q[l+768>>0]+q[E+1024>>0]+q[M+1280>>0]>>16)-128,U[G]=(q[l+1280>>0]+q[E+1536>>0]+q[M+1792>>0]>>16)-128;e=h(Q,b,e,m,D),f=h(S,j,f,s,T),i=h(U,j,i,s,T),c+=32}F+=8}if(P>=0){var H=[];H[1]=P+1,H[0]=(1<<P+1)-1,t(H)}if(v(65497),n){for(var K=J.length,L=new Uint8Array(K),O=0;O<K;O++)L[O]=J[O].charCodeAt();J=[];V=(new Date).getTime()-o;return console.log("Encoding time: "+V+"ms"),L}var R="data:image/jpeg;base64,"+btoa(J.join(""));J=[];var V=(new Date).getTime()-o;return console.log("Encoding time: "+V+"ms"),R},function(){var a=(new Date).getTime();r||(r=50),l(),o(),e(),f(),d(r);var n=(new Date).getTime()-a;console.log("Initialization "+n+"ms")}()}