$(function(){var s=$("#form_paypsw");s.validate({rules:{payPassword_rsainput:{minlength:6,maxlength:6,required:!0,digits:!0,numPassword:!0,echoNum:!0}},messages:{payPassword_rsainput:{required:'<i class="icon icon-attention icon-lg"></i>&nbsp;请填写支付密码',maxlength:'<i class="icon icon-attention icon-lg"></i>&nbsp;密码最多为{0}个字符',minlength:'<i class="icon icon-attention icon-lg"></i>&nbsp;密码最少为{0}个字符',digits:'<i class="icon icon-attention icon-lg"></i>&nbsp;密码只能为数字',numPassword:'<i class="icon icon-attention icon-lg"></i>&nbsp;连号不可用，相同数字不可用（如：123456，11111）',echoNum:'<i class="icon icon-attention icon-lg"></i>&nbsp;连号不可用，相同数字不可用（如：123456，11111）'}},errorPlacement:function(s,a){a.closest('div[data-error="i_error"]').append(s)},submitHandler:function(s){$(s)}});var a=$("#payPassword_container"),i=a.find("i"),n=0,e=0,t=$("#cardwrap");a.on("focus","input[name='payPassword_rsainput']",function(){var s=a.find("i");"0"===a.attr("data-busy")&&(s.eq(n).addClass("active"),t.css("visibility","visible"),a.attr("data-busy","1"))}),a.on("change input  propertychange","input[name='payPassword_rsainput']",function(){if(console.log(123),t.css("visibility","hidden"),i.eq(n).removeClass("active"),a.attr("data-busy","0"),($(this).val().split("").pop()||0)<10)for(n=this.value.length,l=i.length;l--;)l===n?(i.eq(l).addClass("active"),i.eq(l).find("b").css("visibility","hidden")):(i.eq(l).removeClass("active"),i.eq(l).find("b").css("visibility",l<n?"visible":"hidden")),e=6===n?5:n,$("#cardwrap").css("left",39*e+"px");else{var s=this.value;this.value=s.replace(/\D/g,"")}}).on("blur","input[name='payPassword_rsainput']",function(){t.css("visibility","hidden"),i.eq(n).removeClass("active"),a.attr("data-busy","0")}),a.on("keyup ","input[name='payPassword_rsainput']",function(s){var a=s||window.event;console.log(a.keyCode,"e.keyCode"),13==a.keyCode&&($(".step2").hasClass("hide")?$(".pass-next").click():$(".pass-submit").click())}),s.submit(function(s){return console.log(112311),!1}),$(".pass-next").click(function(s){if(0==$("#payPassword_rsainput-error").length&&6==$("#payPassword_rsainput").val().length){$(".step1").addClass("hide"),$(".pass-next").addClass("hide"),$(".step2").removeClass("hide"),$(".pass-submit").removeClass("hide");var a=$("#payPassword_rsainput");$("#payPassword_rsainput").data("pwd1",a.val()),a.val(""),$(".sixDigitPassword-box").find("i b").css({visibility:"hidden"}),a.focus(),$("#cardwrap").css("left",0)}return!1}),$(".pass-reset").click(function(s){return CommonUtil.redirectUrl("loan/loan_password.html?v_"+(new Date).getTime()),!1}),$(".pass-submit").click(function(s){var a=$("#payPassword_rsainput"),i=a.val();return i===a.data("pwd1")?$.ajax({url:window._appPath+"transpassword/setup.do",type:"post",dataType:"json",data:{openId:$.cookie("openId"),transPassword:i}}).done(function(s){var a=s;console.log(a,"password"),0==s.code||101==s.code?CommonUtil.redirectUrl("loan/loan_password_success.html?v_"+(new Date).getTime()):(alert(s.message),window.location.reload())}).fail(function(){console.log("error")}).always(function(){console.log("complete")}):($("#payPassword_container").append('<span id="payPassword_rsainput-error" class="help-block"><i class="icon icon-attention icon-lg"></i>&nbsp;两次密码输入不一致</span>'),$(".pass-submit").addClass("hide"),$(".pass-reset").removeClass("hide")),!1}),setTimeout(function(){a.focus()},600)});