<!DOCTYPE html>
<html>
<head>
	<title>阅读协议</title>
	<!-- <base href="/test/"/> -->
<base href="/bulid/"/>

<meta charset="UTF-8"/>

<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
<!-- 尺寸的设置以及页面是否允许缩放 -->
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0"/>
<!-- 删除苹果默认的工具栏和菜单栏 -->
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black"/>
<!-- 忽略页面中的数字识别为电话,忽略email识别 -->
<meta name="format-detection" content="telephone=no, email=no"/>
<!-- 启用360浏览器的极速模式(webkit) -->
<meta name="renderer" content="webkit"/>
<!-- 解决http https混合加载的安全性问题 -->
<meta http-equiv="Content-Security-Policy" content="block-all-mixed-content"/>

<link rel="shortcut icon" href="favicon.ico">
<link rel="stylesheet" href="css/base.css"/>
<link rel="stylesheet" href="css/style.css?v_1502431016427"/>
<script>
	// 项目根路径
	// window._appPath = "http://210.14.129.41:8080/";
	window._appPath = "/msxfInterface/";
	// window._sitePath = "/test/"; // 测试
	window._sitePath = "/bulid/"; // 测试
</script>

</head>
<body style="background: #eee;">
<header><a href="javascript:history.back(-1)" class="return_a">返回</a>阅读协议</header>
<div class="main">
	<!-- 第三步 begin -->
	<div class="three-step region-box">
		<div class="read-agreement-box">
			<!-- <div class="h3">阅读协议</div> -->
			<div class="bd">
				<div class="iframe" >
					<iframe src="" id="iframeContract" width="100%" frameborder="0" scrolling="auto"></iframe>
				</div>
			</div>
		</div>
		<button v-on:click="clickFn()" disabled="disabled" class="btn-next btn btn-view">提交</button>
	</div>
	<!-- 第三步 end -->
</div>
</body>
<style>
	.iframe{height: 500px;width: 100%;overflow-x: hidden;overflow-y: auto;}
</style>
	
<!-- <scr ipt src='js/lib/zepto/zepto.min.js'></script> -->
<!-- <sc ript src='js/lib/zepto.cookie/zepto.cookie.min.js'></script> -->
<script src='js/lib/jquery/3.1.1/jquery.min.js'></script>
<script src='js/lib/jquery.cookie/jquery.cookie.js'></script>
<script src='js/lib/vue/vue.min.js'></script>
<script src='js/lib/vue/vue-resource.min.js'></script>
<script src='js/common/dictionary.js'></script>
<script src='js/common/common.js'></script>
<script src='js/common/main.js?v_1502431016427'></script>
<!-- <sc ript src="data/city.data.js"></script> -->
<!-- <scr ipt src="js/loan/step3.js"></script> -->
<script>
	$(function () {

     new Vue({
        el:'.main',
        data:{
        	iframeH:500
        },
        methods:{
            scrollFn:function(e){
            	// $.alert($('.iframe'))
            	var _this = this;
                $('.iframe').on('scroll',  function(event) {
                	// function(event) {
	                    var fh = $(this).height()
	                    var docH = _this.iframeH
	                    var t = $(this).scrollTop()
	                    // $.alert(1+'-'+docH+' '+t+' '+fh)
	                    if(docH-t-fh<=0){
	                        $('.btn-view').removeAttr('disabled')
	                    }
	                // }
                }); 
                // $($('#iframeContract')[0].contentWindow).scroll(function(event) {
                //     /* Act on the event */
                //     var fh = $('#iframeContract').height()
                //     var docH = $(this).height()
                //     var t = $(this).scrollTop()
                //     $.alert(docH+' '+t+' '+fh)
                //     if(docH-t-fh<=0){
                //         $('.btn-view').removeAttr('disabled')
                //     }
                // });
                
            },
            clickFn:function(){

                this.$http.post(window._appPath +'contract/confirm.do',{
                    openId:$.cookie('openId')
                },{
                    emulateJSON:true
                }).then(function(res){
                    var data = res.data; 
                    if(data.code==0){
                        // code    String  是   状态码
                        // message String  是   状态信息
                        // data    String  是   应答报文数据

                        CommonUtil.redirectUrl('loan/loan_step6.html');
                        // CommonUtil.redirectUrl('loan/loan_step4.html');
                    }else{
                        $.alert(data.message)
                    }
                })
                // CommonUtil.redirectUrl('loan/loan_step4.html');
            },
            getFn:function(){
                // this.$http.post(window._appPath +'contract/html.do',{
                var _this = this;
                this.$http.post(window._appPath +'contract/credit/auth.do',{
                    openId:$.cookie('openId')
                },{
                    emulateJSON:true
                }).then(function(res){
                    var data = res.data;
                    console.log(data,'contract/html.do')
                    if(data.code==0){
                        // var obj = jQuery.parseJSON(data.data.htmlContract);
                        // $(document.getElementById('iframeContract').contentWindow.document.body).html(obj.content)
                        $('#iframeContract').contents().find('body').html(data.data.htmlContract)
                        var h = $('#iframeContract').contents().find('html').height()
                        _this.iframeH = h
                        $('#iframeContract').height(h)
            			this.scrollFn();

                    }else{
                        $.alert(data.message)
                    }
                })
            }
        },
        created:function(){
            this.getFn();
            // $(window).height()
            $('.iframe').height($(window).height()-234)
        }
    })

});
</script>
</html>
